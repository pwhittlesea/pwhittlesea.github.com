{{/* Hugo shortcode version of mm-gallery.html */}}
{{ $gallery := index .Page.Params (.Get "id") }}

{{/* Determine gallery layout */}}
{{ $gallery_layout := "tw:grid-cols-1" }}
{{ if eq (mod (len $gallery) 3) 0 }}
  {{ $gallery_layout = "tw:grid-cols-3" }}
{{ else if eq (mod (len $gallery) 2) 0 }}
  {{ $gallery_layout = "tw:grid-cols-2" }}
{{ end }}

<figure {{ with .Get "class" }}class="{{ . }}"{{ end }}>
  <span class="tw:grid {{ $gallery_layout }} tw:gap-1">
    {{ range $gallery }}
      {{- $alt := .alt }}
      {{- $title := .title }}
      {{- $resource := "" }}
      {{- if $.Page.Resources.GetMatch .image_path }}
        {{- $resource = $.Page.Resources.GetMatch .image_path }}
      {{- else if resources.GetMatch .image_path }}
        {{- $resource = resources.Get .image_path }}
      {{- else -}}
        {{- errorf "Image not found: %s" .image_path -}}
      {{- end }}
      {{- with $resource }}
        <img
          class="rounded-md tw:mt-0! tw:mb-0"
          srcset="{{ (.Resize "330x").RelPermalink }} 330w, {{ (.Resize "660x").RelPermalink }} 660w, {{ (.Resize "1024x").RelPermalink }} 1024w, {{ (.Resize "1320x").RelPermalink }} 2x"
          src="{{ (.Resize "660x").RelPermalink }}"
          data-zoom-src="{{ (.Resize "1320x").RelPermalink }}"
          {{ with $alt }}alt="{{ . | htmlEscape }}"{{ end }}
          {{ with $title }}title="{{ . | htmlEscape }}"{{ end }}
        />
      {{- end -}}
    {{ end }}
    </span>
  {{ with .Get "caption" }}
    <figcaption class="text-center">{{ . | markdownify }}</figcaption>
  {{ end }}
</figure>
